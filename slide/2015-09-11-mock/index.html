<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>Have you seen the Mock Muack yet?</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=792, user-scalable=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab|Oxygen+Mono" rel="stylesheet" type="text/css">
  <link href="../asset/screen-8.4.css" rel="stylesheet" type="text/css">
  <style>
    .slide div.universe,
    .slide div.proof,
    .slide div.proof-invisible,
    .slide div.program, .slide div.test{
      padding: 0;
      top: 2.5%;
      margin: auto;
      position: relative;
      border-radius: 50%;
      text-align: center;
    }
    .slide div.universe{
      width: 600px;
      height: 600px;
      background-color: #4b86c2;
    }
    .slide div.proof-invisible{
      width: 500px;
      height: 500px;
      background-color: #4b86c2;
    }
    .slide div.proof{
      width: 500px;
      height: 500px;
      background-color: teal;
    }
    .slide div.program{
      width: 400px;
      height: 400px;
      background-color: #cf6a4c;
    }
    .slide div.test{
      width: 300px;
      height: 300px;
      background-color: orange;
    }
    pre .highlight .hljs-title{
      color: white;
    }
  </style>
</head>
<body class="list">
  <header class="caption"></header>

<section class="slide shout"><div>
  <h2 style="top:60%; line-height:1em">
    Have you seen the Mock <a style="border-bottom:none" href="https://github.com/godfat/muack">Muack</a> yet?</h2>
  <div style="text-align: center"><a href="http://godfat.org/slide/2015-09-11-mock/">http://godfat.org/slide/2015-09-11-mock/</a></div>
</div></section>

<section class="slide"><div>
  <h2>Who?</h2>
  <img class="avatar" src="../asset/spiritual_soul.jpg">
  Lin Jen-Shin (godfat)
  <p>
    <ul><li><span class="date">2001~2004:</span> C</li>
        <li><span class="date">2004~2009:</span> ActionScript</li>
        <li><span class="date">2005~2008:</span> C++</li>
        <li><span class="date">2006~<span class="lib">2015</span>:</span> <span class="red">Ruby</span></li>
        <li><span class="date">2007~<span class="lib">2015</span>:</span> (learning) <span class="blue">Haskell</span></li></ul>
  </p>
</div></section>

<section class="slide"><div>
  <h3><a href="http://rubyconf.tw/2010">RubyConf.TW 2010</a> (Lightning Talk)</h3>
  <ul>
    <li><a href="http://www.godfat.org/slide/2010-04-24-cerealize.pdf">cerealize</a>
    — Serialize out of the Cerealize Box:<br>
    A drop-in replacement for ActiveRecord's serialize</li>
  </ul>
  <span class="next">
    <h3><a href="http://rubyconf.tw/2011/#6">RubyConf.TW 2011</a></h3>
    <ul>
      <li><a href="http://www.godfat.org/slide/2011-08-27-rest-core.html">rest-core</a>
      — A modular Ruby REST client collection/infrastructure</li>
    </ul>
  </span>
  <span class="next">
    <h3><a href="http://rubyconf.tw/2012/">RubyConf.TW 2012</a></h3>
    <ul>
      <li><a href="http://www.godfat.org/slide/2012-12-07-concurrent.pdf">Concurrent Ruby Application Servers</a></li>
    </ul>
  </span>
</div></section>

<section class="slide"><div>
  <h3><a href="http://rubyconf.tw/2013">RubyConf.TW 2013</a>
  <ul>
    <li>404 — Conference Not Found<br><br></li>
  </ul>
  <span class="next">
  <h3><a href="http://rubyconf.tw/2014/#speaker-godfat">RubyConf.TW 2014</a></h3>
  <ul>
    <li><a href="http://www.godfat.org/slide/2014-04-25-rubyqc/">RubyQC</a>
    — A conceptual QuickCheck library for Ruby</li>
  </ul>
  </span>
  <span class="next">
  <h3><a href="http://2015.rubyconf.tw/#godfat">RubyConf.TW 2015</a></h3>
  <ul>
    <li>Have you seen the Mock Muack yet?</li>
  </ul>
  </span>
</div></section>

<section class="slide shout" style="background-color:#073648"><div>
  <h2>
    <a style="border-bottom:0" href="https://www.codementor.io"><img src="LightningTalk2014RubyConf.png"></a>
  </h2>
</div></section>

<section class="slide"><div>
  <h2>Table of Contents</h2>
  <ul><li class="red">Introduction</li>
      <li>When?</li>
      <li>Muack</li>
      <li>Trade-Offs</li>
      <li>Possibilities</li></ul>
</div></section>

<section class="slide">
  <div class="universe">Universe
  <div class="proof-invisible">&nbsp;
  <div class="program">Program</div></div></div>
</section>

<section class="slide">
  <div class="universe">Universe
  <div class="proof">Proofs
  <div class="program">Program</div></div></div>
</section>

<section class="slide">
  <div class="universe">Universe
  <div class="proof">(Type System)
  <div class="program">Program</div></div></div>
</section>

<section class="slide">
  <div class="universe">Universe
  <div class="proof">(Type System)
  <div class="program">Program
  <div class="test">Tests</div></div></div></div>
</section>

<section class="slide shout"><div>
  <h2>Testing<br>is part of <em>development process</em></h2>
</div></section>

<section class="slide shout"><div>
  <h2><em>Not</em> part of the program</h2>
</div></section>

<section class="slide shout"><div>
  <h2>Pick the one <em>fits</em> into your team</h2>
</div></section>

<section class="slide"><div>
  <h2>Software Testing</h2>
  <ul><li><a href="https://en.wikipedia.org/wiki/Unit_testing">Unit Testing</a></li>
      <li class="next"><a href="https://en.wikipedia.org/wiki/Integration_testing">Integration Testing</a></li>
      <li class="next"><a href="https://en.wikipedia.org/wiki/System_testing">System Testing</a></li>
      <li class="next">...</li></ul>
</div></section>

<section class="slide"><div>
  <h2><a href="https://en.wikipedia.org/wiki/Test_double">Test double</a></h2>
  <blockquote>A test double is a <em>generic (meta) term</em> used for these objects or procedures.</blockquote>
</div></section>

<section class="slide"><div>
  <h2><a href="https://en.wikipedia.org/wiki/Test_double">Test double</a></h2>
  <blockquote>A test double is a <span style="text-decoration: line-through">generic (meta) term</span> <em>buzzword</em> used for these objects or procedures.</blockquote>
</div></section>

<section class="slide"><div>
  <h2><a href="https://en.wikipedia.org/wiki/Mock_object">Mock object</a></h2>
  <blockquote>In object-oriented programming, mock objects are simulated objects that <em>mimic the behavior of real objects</em> in controlled ways.</blockquote>
</div></section>

<section class="slide"><div>
  <h2>Table of Contents</h2>
  <ul><li>Introduction</li>
      <li class="red">When?</li>
      <li>Muack</li>
      <li>Trade-Offs</li>
      <li>Possibilities</li></ul>
</div></section>

<section class="slide"><div>
  <h2>When?</h2>
  <ul><li><em>Non-deterministic</em> (e.g. current time or concurrency)</li>
      <li class="next"><em>Difficult to reproduce</em> (e.g. network error or race condition)</li>
      <li class="next"><em>Too slow</em> (e.g. external network<br>or slow components which have already been tested)</li></ul>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code>
require 'time'

class Ticket &lt; Struct.new(:time)
  def expired?
    Time.parse(time) &lt; Time.<span class="highlight">now</span>
  end
end

    <span class="next">Ticket.new('2015-09-11').expired?</span></code></pre>
</div></section>

<section class="slide"><div>
  <h2>Difficult to reproduce</h2>
  <h3>Network error</h3>
  <pre><code>
require 'socket'

sock = TCPSocket.new('t.co', 80)
sock.write("GET / HTTP/1.0\r\nHost: t.co\r\n\r\n")
begin
  IO.select([sock])
  sock.<span class="highlight">read_nonblock</span>(256)
rescue IO::WaitReadable
  retry <span class="next"># How to test this clause?</span>
end
sock.close</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Too slow</h2>
  <h3>Random bytes</h3>
  <pre><code class="ruby">
data = File.<span class="highlight">read</span>('/dev/random', 2**20)</code></pre>
  <span class="next" style="position: relative; top: -30px">
    <h3>Upload data</h3>
    <pre><code class="ruby">
require 'socket'
sock = TCPSocket.new('t.co', 80)
sock.write("POST / HTTP/1.0\r\nHost: t.co\r\n\r\n")
sock.<span class="highlight">write</span>(data)
sock.close</code></pre>
  </span>
</div></section>

<section class="slide"><div>
  <h2>Table of Contents</h2>
  <ul><li>Introduction</li>
      <li>When?</li>
      <li class="red">Muack</li>
      <li>Trade-Offs</li>
      <li>Possibilities</li></ul>
</div></section>

<section class="slide"><div>
  <h2>Muack</h2>
  <blockquote>
    <p style="position: relative; top: 0.5em">Muack -- A fast, small, yet powerful mocking library.</p>
    <p>Inspired by <a href="https://github.com/rr/rr">RR</a>, and it's 32x times faster (750s vs 23s)
    <br>
    than RR for running <a href="https://github.com/godfat/rib">Rib</a> tests.</p></blockquote>
</div></section>

<section class="slide"><div>
  <h2>Why?</h2>
  <blockquote style="width: 105%">
    <p style="position: relative; top: 0.5em">Because RR has/had some bugs and it is too complex for me to fix it.</p>
  </blockquote>
</div></section>

<section class="slide"><div>
  <h2>Kernel: Hello!</h2>
  <pre><code>
require 'pork/auto'
require 'muack'

describe Kernel do
  include Muack::API
  before{ Muack.reset  }
  after { Muack.verify }

  would 'puts' do
    mock(self).puts(is_a(String)){ ok }
    puts "Hello!"
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code>
require 'time'

class Ticket &lt; Struct.new(:time)
  def expired?
    Time.parse(time) &lt; Time.<span class="highlight">now</span>
  end
end

    Ticket.new('2015-09-11').expired?


</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code class="ruby">








    Ticket.new('2015-09-11').expired?


</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code>
describe Ticket do





  would 'not expired?' do
    mock(Time).now{ Time.at(0) }
    Ticket.new('2015-09-11').expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code>
describe Ticket do





  would 'not expired?' do
    mock(Time).now{ Time.at(0) }
    expect(Ticket.new('2015-09-11')).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time</h3>
  <pre><code>
describe Ticket do
  would 'expired?' do
    mock(Time).now{ Time.parse('2015-09-12') }
    expect(Ticket.new('2015-09-11')).expired?
  end

  would 'not expired?' do
    mock(Time).now{ Time.at(0) }
    expect(Ticket.new('2015-09-11')).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em>)</h3>
  <pre class="next"><code class="ruby">
class Ticket &lt; Struct.new(:time, <span class="highlight">:time_class</span>)
  <span class="next">def initialize new_time, new_time_class=Time
    super(new_time, new_time_class)
  end</span>

  <span class="next">def expired?
    Time.parse(time) &lt; <span class="highlight">time_class</span>.now
  end</span>
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em> and simple stubs)</h3>
  <pre style="width: 105%"><code class="ruby">
describe Ticket do
  would 'expired?' do
    t = Struct.new(:now).new(Time.parse('2015-09-12'))
    expect(Ticket.new('2015-09-11', t)).expired?
  end

  would 'not expired?' do
    t = Struct.new(:now).new(Time.at(0))
    expect(Ticket.new('2015-09-11', t)).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>What are the terms?</h2>
  <blockquote>Classification between <em>mocks</em>, <em>fakes</em>, and <em>stubs</em> is highly inconsistent across literature.</blockquote>
  <span class="next"><p>[...]</p>
  <blockquote>Which of the mock, fake, or stub is the simplest is inconsistent, but the simplest always returns <em>pre-arranged responses</em>.</blockquote></span>
</div></section>

<section class="slide"><div>
  <h2><a href="https://en.wikipedia.org/wiki/Test_double">Test double</a></h2>
  <blockquote>A test double is a <span style="text-decoration: line-through">generic (meta) term</span> <em>buzzword</em> used for these objects or procedures.</blockquote>
</div></section>

<section class="slide"><div>
  <h2><a href="https://en.wikipedia.org/wiki/Mock_object">Mock object</a></h2>
  <blockquote>In object-oriented programming, mock objects are simulated objects that <em>mimic the behavior of real objects</em> in controlled ways.</blockquote>
</div></section>

<section class="slide"><div>
  <h2><a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks Aren't Stubs</a></h2>
  <h3>The Difference Between Mocks and Stubs</h3>
  <ul class="next">
    <li><span class="red">Dummy</span> are passed around but never actually used.</li>
    <li class="next"><span class="red">Fake</span> actually have working implementations,<br>but usually take some shortcut.</li>
    <li class="next"><span class="red">Stubs</span> provide canned answers to calls made during the test.</li>
    <li class="next"><span class="red">Mocks</span> are pre-programmed with <em>expectations</em> which form a <em>specification</em> of the calls they are expected to <em>receive</em>.</li></ul>
</div></section>

<section class="slide"><div>
  <h2><a href="https://github.com/godfat/muack">Muack</a></h2>
  <h3>There are also 4 different kinds of mocks in Muack, which are:</h3>
  <ul>
    <li>Mocks</li>
    <li>Stubs</li>
    <li>Spies</li>
    <li>Coats</li></ul>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em> and simple stubs)</h3>
  <pre style="width: 105%"><code class="ruby">
describe Ticket do
  would 'expired?' do
    t = Struct.new(:now).new(Time.parse('2015-09-12'))
    expect(Ticket.new('2015-09-11', t)).expired?
  end

  would 'not expired?' do
    t = Struct.new(:now).new(Time.at(0))
    expect(Ticket.new('2015-09-11', t)).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em> and <em>muack</em> stubs)</h3>
  <pre style="width: 105%"><code class="ruby">
describe Ticket do
  would 'expired?' do
    t = stub.now{ Time.parse('2015-09-12') }.object
    expect(Ticket.new('2015-09-11', t)).expired?
  end

  would 'not expired?' do
    t = stub.now{ Time.at(0) }.object
    expect(Ticket.new('2015-09-11', t)).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em> and <em>muack</em> mocks)</h3>
  <pre style="width: 105%"><code class="ruby">
describe Ticket do
  would 'expired?' do
    t = mock.now{ Time.parse('2015-09-12') }.object
    expect(Ticket.new('2015-09-11', t)).expired?
  end

  would 'not expired?' do
    t = mock.now{ Time.at(0) }.object
    expect(Ticket.new('2015-09-11', t)).not.expired?
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>dependency injection</em> and <em>muack</em> spies)</h3>
  <pre style="width: 105%"><code class="ruby">
describe Ticket do
  would 'expired?' do
    t = stub.now{ Time.parse('2015-09-12') }.object
    expect(Ticket.new('2015-09-11', t)).expired?
    spy(t).now


  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>muack</em> spies)</h3>
  <pre><code>
describe Ticket do
  would 'expired?' do
    stub(Time).now{ Time.parse('2015-09-12') }
    expect(Ticket.new('2015-09-11')).expired?
    spy(Time).now
    <span class="next">Muack.verify</span>
    <span class="next">Time.now # => real time here</span>
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Non-deterministic</h2>
  <h3>Current time (with <em>muack</em> coats)</h3>
  <pre><code>
describe Ticket do
  would 'expired?' do
    coat(Time).now{ Time.parse('2015-09-12') }
    expect(Ticket.new('2015-09-11')).expired?


    Time.now # => real time here
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#proxy-mode">Proxy Mode</a></h2>
  <blockquote>There are chances that we don't really want to change the underlying implementation for a given method, <em>but we still want to make sure the named method is called</em>, and that's what we're testing for.</blockquote>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#partial-mode">Partial Mode</a></h2>
  <blockquote>Partial mode is not really a mode, but a combination of using proxy mode and the <a href="https://github.com/godfat/muack#arguments-verifiers-satisfy">pattern matching mechanism</a> specialized in stubs.</blockquote>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#any_instance_of-mode"><code>any_instance_of</code></a></h2>
  <p>Well, sort of a hack to <em>avoid dependency injection</em> yet making it testable.</p>
  <span class="next">
    <h3><a href="https://en.wikipedia.org/wiki/Dependency_injection#Disadvantages">Dependency Injection Disadvantages</a></h3>
    <ul><li>It forces complexity to move out of classes and into the linkages between classes which might <em>not always be desirable or easily managed</em>.</li></ul>
    </span>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#mocks-modifiers">Modifiers</a></h2>
  <ul>
    <li>times</li>
    <li class="next">with_any_args</li>
    <li class="next">returns (instance_exec mode)</li>
    <li class="next">peek_args (instance_exec mode)</li>
    <li class="next">peek_return (instance_exec mode)</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#arguments-verifiers-satisfying">Arguments Verifiers</a></h2>
  <ul>
    <li>anything</li>
    <li class="next">is_a</li>
    <li class="next">matching</li>
    <li class="next">including</li>
    <li class="next">within</li>
    <li class="next">responding_to</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#arguments-verifiers-satisfying">Arguments Verifiers</a></h2>
  <ul>
    <li>where</li>
    <li>having</li>
    <li>allowing</li>
    <li class="next">satisfying</li>
    <li class="next">Disjunction (|)</li>
    <li class="next">Conjunction (&amp;)</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Muack <a href="https://github.com/godfat/muack#caveat">Caveat</a></h2>
  <ul>
    <li>Mixing mocks and stubs</li>
    <li><code>any_instance_of</code> shares all calls for a given class</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Table of Contents</h2>
  <ul><li>Introduction</li>
      <li>When?</li>
      <li>Muack</li>
      <li class="red">Trade-Offs</li>
      <li>Possibilities</li></ul>
</div></section>

<section class="slide"><div>
  <h2>Trade-Offs</h2>
  <ul>
    <li class="red">Test Isolation</li>
    <li>Dependency Injection</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Test Isolation -- without mocks</h2>
  <h3>Advantages:</h3>
  <ul>
    <li>More confidence -- we're testing against real stuffs!</li></ul>
  <span class="next">
    <hr>
    <h3>Disadvantages:</h3>
    <ul style="width: 105%">
      <li>Test not isolated -- more complex runtime &amp; harder to track down bugs</li>
      <li class="next">Could be slow</li></ul>
  </span>
</div></section>

<section class="slide"><div>
  <h2>Test Isolation -- with mocks</h2>
  <h3>Advantages:</h3>
  <ul>
    <li>Test isolation -- one bug one test breaks so easier to track</li>
    <li>Could be much easier to setup</li></ul>
  <span class="next">
    <hr>
    <h3>Disadvantages:</h3>
    <ul style="width: 105%">
      <li>Need to implement with mocks -- duplicated implementation</li>
      <li class="next">↑ Coupled with mocks -- spec changes, update two implementation</li>
      <li class="next">↑ Mocks could be coupled with private API -- very brittle</li></ul>
  </span>
</div></section>

<section class="slide"><div>
  <h2>Trade-Offs</h2>
  <ul>
    <li>Test Isolation</li>
    <li class="red">Dependency Injection</li>
  </ul>
</div></section>

<section class="slide"><div>
  <h2>Without Dependency Injection</h2>
  <h3>Advantages:</h3>
  <ul>
    <li>Easier to write for the simplest case</li>
    <li class="next">↑ Less complexity</li></ul>
  <span class="next">
    <hr>
    <h3>Disadvantages:</h3>
    <ul>
      <li>Dependencies are more coupled and unclear</li>
      <li class="next">Harder to mock (might need to mock globally, which is inherently thread unsafe, less isolation, more coupled)</li></ul>
  </span>
</div></section>

<section class="slide"><div>
  <h2>Without Dependency Injection</h2>
  <h3>Advantages:</h3>
  <ul>
    <li>Easier to write for the simplest case</li>
    <li class="next">↑ Less complexity</li></ul>
  <span class="next">
    <hr>
    <h3>Disadvantages:</h3>
    <ul>
      <li>Dependencies are more coupled and unclear</li>
      <li class="next">Harder to mock (might need to mock globally, which is inherently thread unsafe, less isolation, more coupled)</li></ul>
  </span>
</div></section>

<section class="slide"><div>
  <h2>Table of Contents</h2>
  <ul><li>Introduction</li>
      <li>When?</li>
      <li>Muack</li>
      <li>Trade-Offs</li>
      <li class="red">Possibilities</li></ul>
</div></section>

<section class="slide"><div>
  <h2 class="fullscreen">Auto-mocking with <a href="https://github.com/bblimke/webmock">webmock</a></h2>
  <pre class="fullscreen"><code>
WebMock.disable_net_connect!

copy :automock do
  before do
    stub(Notify).new_notification.
      with_any_args.peek_args do |*args|
        <span class="highlight">stub_firebase</span>("notify/#{args.first.fid}")
        args
      end
  end
end

describe Notify do
  paste :automock
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2 class="fullscreen">Truncate only inserted tables</h2>
  <pre class="fullscreen"><code>
Model = Class.new(Sequel::Model)
copy :model do
  def inserted; @inserted ||= {}; end
  before do
    test = self
    stub(any_instance_of(Model))._insert.
      peek_return(:instance_exec => true) do |r|
        test.inserted[self.class.table_name] = true
        r
      end
  end
  after do
    Model.truncate_all_tables!(inserted.keys)
  end
end</code></pre>
</div></section>

<section class="slide"><div>
  <h2 class="fullscreen"><a href="https://github.com/godfat/muack#muack-as-a-development-runtime-static-typing-system">As a development runtime static typing system</a></h2>
  <pre class="fullscreen"><code>
Food = Class.new
User = Class.new(Struct.new(:food))

Muack::API.module_eval do
  any_instance_of(User) do |user|
    stub(user).food = is_a(Food) # proxy mode
  end
end

u, f = User.new, Food.new
u.food = f # ok
u.food = 1 # raise Muack::Unexpected</code></pre>
</div></section>

<section class="slide"><div>
  <h2><a href="https://github.com/godfat/muack#muack-as-a-mocky-patching-library">As a mocky patching library</a></h2>
  <pre><code>
Muack::API.stub(RailsAdmin::Config::Actions).find.
  with_any_args.peek_args do |*args|
    custom_key, bindings = args
    if bindings &amp;&amp; bindings[:object] &amp;&amp;
       bindings[:object].id.nil?
      # There's no show page for unsaved records
      [nil, {}]
    else
      args # Bypass arguments
    end
  end</code></pre>
</div></section>

<section class="slide"><div>
  <h2>Bibliography</h2>
  <ul>
    <li><a href="http://xunitpatterns.com/Test%20Double.html">Test Double</a></li>
  </ul>
</div></section>

<section class="slide shout"><div>
<h2>Q?</h2>
<div style="text-align: center; position: relative; top: 10%">
<a href="https://github.com/godfat/muack">https://github.com/godfat/muack</a>
</div>
<br><br><br><br><br><br>
<pre><code class="ruby" style="text-align:center">
<span class="red">gem</span> <span class="hljs-string">install</span> <span class="hljs-constant">muack</span></code></pre>
</div></section>

  <div class="progress"><div></div></div>
  <script src="../asset/shower.min.js"></script>
  <script src='../asset/highlight-8.4.pack.js' type='text/javascript'></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
